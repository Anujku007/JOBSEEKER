{% extends "base.html" %}
{% block title %}JOBSEEKER - {{ job.title or "Job Details" }}{% endblock %}
{% block content %}
{% set job = job or {} %}

<div class="container mx-auto px-4 py-8 max-w-6xl">
  <!-- ðŸ§­ Breadcrumb -->
  <nav class="flex mb-6" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2 text-sm text-gray-600">
      <li><a href="/" class="hover:text-blue-600">Home</a></li>
      <li><i class="fas fa-chevron-right text-xs"></i></li>
      <li><a href="{{ url_for('jobs_bp.job_list') }}" class="hover:text-blue-600">Jobs</a></li>
      <li><i class="fas fa-chevron-right text-xs"></i></li>
      <li class="text-gray-900 font-medium">{{ job.title | default("Job Detail") | truncate(40) }}</li>
    </ol>
  </nav>

  <div class="grid lg:grid-cols-3 gap-8">
    <!-- ðŸ”¹ MAIN JOB DETAIL SECTION -->
    <div class="lg:col-span-2">
      <div class="bg-white rounded-2xl shadow-lg p-8 transition-transform hover:scale-[1.01] duration-200">
        <!-- Job Header -->
        <div class="border-b border-gray-200 pb-6 mb-6">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ job.title or "Untitled Job" }}</h1>
              <div class="flex items-center text-lg text-gray-600 mb-3 flex-wrap">
                <i class="fas fa-building text-gray-400 mr-2"></i>
                <span class="font-semibold">{{ job.company or "Unknown Company" }}</span>
                <span class="mx-2 hidden sm:inline">â€¢</span>
                <i class="fas fa-map-marker-alt text-gray-400 mr-2"></i>
                <span>{{ job.location or "India" }}</span>
              </div>
            </div>

            {% if current_user.is_authenticated %}
            <button class="save-job-btn text-gray-400 hover:text-red-500 text-2xl transition-colors"
                    title="Save Job"
                    data-job-id="{{ job.id }}"
                    data-saved="{{ 'true' if job.is_saved else 'false' }}">
              {% if job.is_saved %}
              <i class="fas fa-heart text-red-500"></i>
              {% else %}
              <i class="far fa-heart"></i>
              {% endif %}
            </button>
            {% endif %}
          </div>

          <div class="flex flex-wrap gap-2">
            <span class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium">
              {{ job.job_type or "Full-time" }}
            </span>
            {% if job.remote %}
            <span class="bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium">
              <i class="fas fa-wifi mr-1"></i>Remote
            </span>
            {% endif %}
            <span class="bg-gray-100 text-gray-800 px-4 py-2 rounded-full text-sm font-medium">
              {{ job.source or "Unknown Source" }}
            </span>
            {% if job.salary %}
            <span class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">
              <i class="fas fa-rupee-sign mr-1"></i>{{ job.salary }}
            </span>
            {% else %}
            <span class="bg-yellow-50 text-yellow-700 px-4 py-2 rounded-full text-sm font-medium">
              Salary not disclosed
            </span>
            {% endif %}
          </div>
        </div>

        <!-- ðŸ“ Job Description -->
        <div class="mb-8">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4">Job Description</h2>
          <div class="prose prose-lg max-w-none text-gray-700 leading-relaxed">
            <p>{{ job.description or "No description available for this position." }}</p>
          </div>
        </div>

        <!-- ðŸ§© Responsibilities -->
        <div class="mb-8">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4">Key Responsibilities</h2>
          <ul class="space-y-3 text-gray-700">
            {% if job.responsibilities %}
              {% for r in job.responsibilities %}
              <li class="flex items-start"><i class="fas fa-check text-green-500 mr-3 mt-1"></i><span>{{ r }}</span></li>
              {% endfor %}
            {% else %}
              <li><i class="fas fa-check text-green-500 mr-2"></i>Build, test, and deploy scalable web applications</li>
              <li><i class="fas fa-check text-green-500 mr-2"></i>Collaborate with design and backend teams</li>
              <li><i class="fas fa-check text-green-500 mr-2"></i>Ensure software quality and performance</li>
            {% endif %}
          </ul>
        </div>

        <!-- ðŸŽ¯ Requirements -->
        <div class="mb-8">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4">Requirements</h2>
          <ul class="space-y-3 text-gray-700">
            {% if job.requirements %}
              {% for req in job.requirements %}
              <li class="flex items-start"><i class="fas fa-star text-blue-500 mr-3 mt-1"></i><span>{{ req }}</span></li>
              {% endfor %}
            {% else %}
              <li><i class="fas fa-star text-blue-500 mr-2"></i>Proficiency in Python & Flask/Django</li>
              <li><i class="fas fa-star text-blue-500 mr-2"></i>Experience with REST APIs and databases</li>
              <li><i class="fas fa-star text-blue-500 mr-2"></i>Strong problem-solving and teamwork skills</li>
            {% endif %}
          </ul>
        </div>

        <!-- ðŸŽ Benefits -->
        <div class="mb-8">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4">What We Offer</h2>
          <ul class="space-y-3 text-gray-700">
            <li><i class="fas fa-gem text-purple-500 mr-3"></i>Competitive salary and growth opportunities</li>
            <li><i class="fas fa-gem text-purple-500 mr-3"></i>Flexible work environment</li>
            <li><i class="fas fa-gem text-purple-500 mr-3"></i>Innovative and inclusive culture</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- ðŸ”¹ SIDEBAR SECTION -->
    <div class="space-y-6">
      <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
        <div class="text-center mb-6">
          {% if job.salary %}
          <div class="text-2xl font-bold text-gray-900 mb-2">{{ job.salary }}</div>
          {% else %}
          <div class="text-sm text-gray-500 mb-2">Salary not disclosed</div>
          {% endif %}
          <div class="text-sm text-gray-500">Posted {{ job.posted_date or "Recently" }}</div>
        </div>

        <!-- Buttons -->
        <div class="space-y-3">
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('jobs_bp.apply_job', job_id=job.id) }}"
             class="apply-job-btn w-full bg-blue-600 text-white py-4 rounded-lg hover:bg-blue-700 font-semibold text-lg transition-colors flex items-center justify-center"
             data-job-id="{{ job.id }}"
             data-applied="{{ 'true' if job.is_applied else 'false' }}">
            <i class="fas fa-paper-plane mr-3"></i>
            <span>{% if job.is_applied %}Applied{% else %}Apply Now{% endif %}</span>
          </a>
          {% else %}
          <a href="{{ url_for('auth.login', next=request.path) }}"
             class="w-full bg-yellow-500 text-white py-4 rounded-lg hover:bg-yellow-600 font-semibold text-lg transition flex items-center justify-center">
            <i class="fas fa-lock mr-2"></i>Sign in to Apply
          </a>
          {% endif %}

          {% if current_user.is_authenticated %}
          <button class="save-job-btn w-full border border-blue-600 text-blue-600 py-3 rounded-lg hover:bg-blue-50 font-semibold transition-colors flex items-center justify-center"
                  data-job-id="{{ job.id }}"
                  data-saved="{{ 'true' if job.is_saved else 'false' }}">
            {% if job.is_saved %}
            <i class="fas fa-bookmark mr-3 text-blue-600"></i> Saved
            {% else %}
            <i class="far fa-bookmark mr-3"></i> Save for Later
            {% endif %}
          </button>
          {% endif %}

          <button class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center"
                  onclick="navigator.clipboard.writeText(window.location.href);Swal.fire('Link Copied!','Share this job with your friends','success')">
            <i class="fas fa-share-alt mr-3"></i> Share Job
          </button>
        </div>

        <!-- Job Info -->
        <div class="mt-6 pt-6 border-t border-gray-200">
          <h3 class="font-semibold text-gray-900 mb-3">Job Details</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between"><span class="text-gray-600">Type:</span><span class="font-medium">{{ job.job_type or 'N/A' }}</span></div>
            <div class="flex justify-between"><span class="text-gray-600">Location:</span><span class="font-medium">{{ job.location or 'N/A' }}</span></div>
            <div class="flex justify-between"><span class="text-gray-600">Company:</span><span class="font-medium">{{ job.company or 'N/A' }}</span></div>
            <div class="flex justify-between"><span class="text-gray-600">Source:</span><span class="font-medium">{{ job.source or 'Unknown' }}</span></div>
            <div class="flex justify-between"><span class="text-gray-600">Posted:</span><span class="font-medium">{{ job.posted_date or 'Recently' }}</span></div>
          </div>
        </div>
      </div>

      <!-- Company Info -->
      <div class="bg-white rounded-2xl shadow-lg p-6">
        <h3 class="font-semibold text-gray-900 mb-4">About {{ job.company or 'the company' }}</h3>
        <p class="text-gray-600 text-sm mb-4 leading-relaxed">
          {{ job.company or "This company" }} is a forward-thinking organization committed to innovation, technology, and empowering employees to achieve success.
        </p>
        <div class="space-y-2 text-sm">
          <div class="flex items-center text-gray-600"><i class="fas fa-globe mr-2"></i><span>www.company.com</span></div>
          <div class="flex items-center text-gray-600"><i class="fas fa-users mr-2"></i><span>50â€“200 employees</span></div>
          <div class="flex items-center text-gray-600"><i class="fas fa-industry mr-2"></i><span>Technology</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- âœ… JS for job actions -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{{ url_for('static', filename='js/job_detail.js') }}"></script>
<script>
console.log("âœ… Job detail page loaded for:", "{{ job.title or 'Unknown Job' }}");
</script>
{% endblock %}
